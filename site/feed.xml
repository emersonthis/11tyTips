<?xml version="1.0" encoding="utf-8"?> <feed xmlns="http://www.w3.org/2005/Atom"><title>11tyTips</title><subtitle>A blog devoted to Eleventy static site generator users</subtitle><link href="https://11tytips.netlify.com/feed.xml" rel="self"/><link href="https://11tytips.netlify.com/"/><updated>2020-01-27T01:00:00+01:00</updated><id>https://11tytips.netlify.com/</id><author><name>octoxalis</name><email>octoxalis@gmail.com</email></author><entry><title>Site structure</title><link href="https://11tytips.netlify.com/tips/site_structure.html"/><updated>2019-12-12T01:00:00+01:00</updated><id>https://11tytips.netlify.com/tips/site_structure.html</id><content type="html"><h1>The JAMstack architecture</h1><p data--="page_intro">The principles of JAMstack static site.</p><h2 id="what_is_jamstack?">What is JAMstack?</h2><p>Eleventy, as most static sites, relies on an architectural paradigm called <a href="https://jamstack.org/" target="_blank" rel="noreferrer noopener">JAMstack</a>, an acronym meaning: <q>a modern web development architecture based on client-side JavaScript, reusable APIs, and prebuilt Markup.</q> (see Mathias Biilmann &amp; Phil Hawksworth book: <a href="https://www.netlify.com/pdf/oreilly-modern-web-development-on-the-jamstack.pdf" target="_blank" rel="noreferrer noopener">Modern Web development on the JAMstack</a>. ).</p><p>In the JAMstack architecture, <em>JavaScript</em> is used not only in the browser for interactivity and presentation but also to build all the files of the site (this is the case of Eleventy. Other generators use different languages: Go, Python, etc. ); the <em>APIs</em> are the programming interfaces to Node packages (Eleventy itself is a Node package. )or other frameworks used as a back end; <em>Markdown</em> is used to set the content of each page of the site, with a settings part (front matter) using either JavaScript or a description language like YAML or TOML and a template part (there are many templating systems: Liquid, Nunjucks, Hanbdlebars, Pug, etc. ).</p><h2 id="11tytips_architecture">11tyTips architecture</h2><p>Trying to stay as simple as possible, 11tyTips is built using a minimal set of the JAMstack architecture: <strong>JavaScript</strong>, backed by the Node ecosystem, <strong>Nunjucks</strong>, as templating system, and <strong>Markdown</strong> as content markup language. It doesn’t follow the canonical dispatching of files promoted by Eleventy and most satic site generators (data, templates, contents), but follows a pattern examplifying the JAMstack paradigm.</p><p>The <code>source</code> directory design reflects the JAMstack categories:</p><ul data--="ulist"><li>make (contains JavaScript modules to be used during the build process and is split in two directories: Eleventy modules (<code>11ty</code>) and 11tyTips modules (<code>lib</code>). <em>This is also where the initial JavaScript file firing the building process is located</em>. Instead of <code>.eleventy.js</code> this file is named <code>make.js</code> (without the starting dot because it is not hidden). )</li><li>matrix (gathers, in <code>./</code> and <code>parts</code> directories, all the templates producing the site HTML files; plus the Javascript and CSS files concatenated and minified (<code>assets</code>). )</li><li>matter (contains the Markdown files of all site posts (<code>pages</code> subdirectory), plus some files they include (<code>parts</code>). )</li></ul><p>I sometimes like to call it the <em>3M</em> directory (all of its subdirectory having names begining with an <em>m</em> letter, enumerating these directory names sounds like a slogan: <q>make matrix matter(s)!</q> ). All subdirectories of the three first level directories follow a consistent naming scheme:</p><ul data--="ulist"><li>assets (for directories containing both script files, style files and files not to be processed and just to be passthru copied to output site; )</li><li>scripts (for JavaScript files and, eventually, other scripting language files )</li><li>styles (for Cascading stylesheet files and, eventually, other styling language files (SCCS, etc.) )</li><li>parts (for partial files to be included by other files. )</li></ul><p>This structure departs deliberately from what is generaly adopted by static sites built with Eleventy (see, for instance, <a href="https://github.com/11ty/eleventy-base-blog" target="_blank" rel="noreferrer noopener">Eleventy base blog</a> structure ), examplifying the versatility of the tool (Eleventy configuration object has two properties allowing this precious flexibility: <code>dir.data</code> and <code>dir.includes</code>. ): <strong>Eleventy doesn’t lock you into a predefined scheme</strong> and let you express your specific needs with ease.</p><p>11tyTips has been designed to offer the maximum of flexibility and consistency in the development phase, keeping a strong separation of concerns as to ease any needed refactoring and modification of the code. The site <a href="https://11tytips.netlify.com/tips/source_tree.html">source tree</a> gives an overview of the source directory hierarchy.</p><p>Following these configuration options leads to a command line <em>requiring</em> the <code>--config</code> argument:</p><p data--="example"><code>npx eleventy --config=make/11ty/make.js</code></p></content></entry><entry><title>Cloning 11tyTips site</title><link href="https://11tytips.netlify.com/tips/site_cloning.html"/><updated>2019-12-12T01:00:00+01:00</updated><id>https://11tytips.netlify.com/tips/site_cloning.html</id><content type="html"><h1>Cloning of 11tyTips site</h1><p data--="page_intro">Why not use 11tyTips as a boilerplate for your own new site?</p><h2 id="install_a_clone_of_11tytips_site">Install a clone of 11tyTips site</h2><p>11tyTips site has been designed to help those wanting to start with a static site generator such as Eleventy, without spending a lot of time to find the best architecture meeting their needs. All tips explained in its pages are exemplified by its source code: the dogfooding principle!</p><p>If you want to use it as a frame for your new site, visit the <a href="https://11tyframe.netlify.com/" target="_blank" rel="noreferrer noopener">11ty Frame</a> site.</p></content></entry><entry><title>Source tree</title><link href="https://11tytips.netlify.com/tips/source_tree.html"/><updated>2019-12-12T01:00:00+01:00</updated><id>https://11tytips.netlify.com/tips/source_tree.html</id><content type="html"><h1>11tyTips site tree</h1><p data--="page_intro">A bird’s eye view of 11tyTips site.</p><hgroup data--="code_ref"><h5><a href="https://github.com/octoxalis/11tyTips/blob/master/source/matter/pages/parts/_source_tree_.txt" target="_blank" rel="noreferrer noopener">11tyTips/source/matter/pages/parts/_source_tree_.txt</a></h5><h6><a href="https://prismjs.com" target="_blank" rel="noreferrer noopener" title="Highlighting provided by Prism.js">Prism</a></h6></hgroup><pre><code class="language-txt">
.
├── make
│   ├── 11ty
│   │   ├── collections.js
│   │   ├── filters.js
│   │   ├── libraries.js
│   │   ├── make.js
│   │   ├── plugins.js
│   │   └── shortcodes.js
│   └── lib
│       ├── block_replace.js
│       ├── block_split.js
│       ├── css_mixin.js
│       ├── data.js
│       ├── dateToISO.js
│       ├── feed_content.js
│       ├── string.js
│       └── template_process.js
|
├── matrix
│   ├── assets
│   │   ├── icons
│   │   │   └── pencil.svg
│   │   ├── scripts
│   │   │   └── js
│   │   │       ├── parts
│   │   │       │   ├── _comments_.js
│   │   │       │   ├── _dom_.js
│   │   │       │   ├── _events_.js
│   │   │       │   ├── _idb_.js
│   │   │       │   ├── _link_page_.js
│   │   │       │   ├── _menu_.js
│   │   │       │   ├── _notes_.js
│   │   │       │   ├── _service_.js
│   │   │       │   ├── _service_worker_.js
│   │   │       │   └── _ui_color_.js
│   │   │       ├── lib.njk
│   │   │       └── service.njk
│   │   ├── static
│   │   │   ├── fonts
│   │   │   │   ├── athiti-v3-latin-regular.woff2
│   │   │   │   ├── FiraCode-Regular.woff2
│   │   │   │   └── harmattan-v5-latin-regular.woff2
│   │   │   ├── media
│   │   │   │   ├── 1px.webp
│   │   │   │   ├── Adam_de_Coster_color.jpg
│   │   │   │   ├── Adam_de_Coster_gray.jpg
│   │   │   │   ├── android-chrome-192x192.png
│   │   │   │   ├── android-chrome-512x512.png
│   │   │   │   ├── apple-touch-icon.png
│   │   │   │   ├── favicon-16x16.png
│   │   │   │   ├── favicon-32x32.png
│   │   │   │   └── wide_img.webp
│   │   │   ├── scripts
│   │   │   │   └── js
│   │   │   │       ├── clipboard.min.js
│   │   │   │       └── prism.min.js
│   │   │   └── styles
│   │   │       └── css
│   │   │           └── prism.min.css
│   │   └── styles
│   │       └── css
│   │           ├── parts
│   │           │   ├── _aspect_ratio_.css
│   │           │   ├── _color_.css
│   │           │   ├── _comment_.css
│   │           │   ├── _destyle_.css
│   │           │   ├── _font_.css
│   │           │   ├── _font_face_mixin_.css
│   │           │   ├── _full_width_.css
│   │           │   ├── _html_.css
│   │           │   ├── _menu_.css
│   │           │   ├── _note_.css
│   │           │   ├── _prism_theme_.css
│   │           │   ├── _properties_.css
│   │           │   ├── _rootvar_.css
│   │           │   ├── _source_tree_.css
│   │           │   └── _ui_.css
│   │           ├── lib_comment.njk
│   │           ├── lib_menu.njk
│   │           ├── lib_prism.njk
│   │           └── lib.njk
│   ├── parts
│   │   ├── blocks
│   │   │   ├── _body_.njk
│   │   │   ├── _body_offline_.njk
│   │   │   ├── _feed_.njk
│   │   │   ├── _head_.njk
│   │   │   ├── _menu_.njk
│   │   │   └── _sitemap_.njk
│   │   ├── _article_.njk
│   │   ├── _banner_.njk
│   │   ├── _colophon_.njk
│   │   ├── _comment_.njk
│   │   ├── _description_.njk
│   │   ├── _favicon_.njk
│   │   ├── _feed_.njk
│   │   ├── _font_inline_.njk
│   │   ├── _head_.njk
│   │   ├── _instant_page_.njk
│   │   ├── _link_page_.njk
│   │   ├── _menu_iframe_.njk
│   │   ├── _netlify_badge_.njk
│   │   ├── _netlify_headers_.njk
│   │   ├── _script_.njk
│   │   ├── _seo_.njk
│   │   ├── _site_url_.njk
│   │   ├── _style_inline_.njk
│   │   └── _webmanifest_.njk
│   ├── feed.njk
│   ├── frame.njk
│   ├── menu.njk
│   ├── offline.njk
│   └── sitemap.njk
|
└── matter
    ├── assets
    │   ├── scripts
    │   │   └── js
    │   │       ├── lib
    │   │       │   ├── A_o.js
    │   │       │   ├── C_o.js
    │   │       │   ├── D_o.js
    │   │       │   ├── F_o.js
    │   │       │   ├── I_o.js
    │   │       │   └── U_o.js
    │   │       ├── lib.md
    │   │       ├── netlify_headers.md
    │   │       ├── service.md
    │   │       └── webmanifest.md
    │   └── styles
    │       └── css
    │           ├── lib_comment.md
    │           ├── lib_menu.md
    │           ├── lib_prism.md
    │           └── lib.md
    └── pages
        ├── parts
        │   └── _source_tree_.txt
        ├── 404.md
        ├── creating_menu.md
        ├── css_mixins.md
        ├── eleventy_configure.md
        ├── feed.md
        ├── frontmatter_data.md
        ├── frontmatter_function.md
        ├── index.md
        ├── lightning_images.md
        ├── menu.md
        ├── minifying.md
        ├── names_guide.md
        ├── offline.md
        ├── pre_post_processing.md
        ├── shortcodes.md
        ├── shorthands.md
        ├── site_cloning.md
        ├── site_configure.md
        ├── site_structure.md
        ├── sitemap.md
        ├── source_tree.md
        ├── styles_guide.md
        └── variables_inheritance.md
</code></pre></content></entry><entry><title>Eleventy settings</title><link href="https://11tytips.netlify.com/tips/eleventy_configure.html"/><updated>2019-12-12T01:00:00+01:00</updated><id>https://11tytips.netlify.com/tips/eleventy_configure.html</id><content type="html"><h1>Eleventy configuration</h1><p data--="page_intro">You can customize Eleventy starting file as you see fit.</p><h2 id="the_eleventy_javascript_file">The Eleventy JavaScript file</h2><p>Eleventy uses a simple file, named by default <code>.eleventy.js</code> (because of the leading dot it’s an hidden file ), to define the settings of the building environment. This file is, by default, located at the root of the source folder but it can be put anywhere. The name itself can also be changed, if you see fit. (11tyTips modifies both the name, calling it <code>make.js</code>, and the location, putting it in the <code>source/make/11ty</code> directory. )</p><p>This file defines the settings of the main resources used in the building process: <em>libraries</em>, <em>shortcodes</em>, <em>filters</em>, <em>plugins</em>, etc. 11tyTips fragments this monolithic file in specific modules, each devoted to a part of the configuration, all located in the <code>source/make/11ty/</code> directory. The configuration object returned by the configuration/make file is important because it defines the location of the main components of the building process: the <code>input</code> and <code>output</code> directories, the templates processors, etc.</p><p>11tyTips declares its own set of directories, modifying some of the default names and locations (for instance, the leading underscore character is suppressed for <code>output</code>, <code>lib</code> and <code>matrix</code> directories, in lieu of <code>_output</code>, <code>_data</code> and <code>_includes</code>; <code>static</code> directory is named <code>assets</code>, etc. )</p><hgroup data--="code_ref"><h5><a href="https://github.com/octoxalis/11tyTips/blob/master/source/make/11ty/make.js" target="_blank" rel="noreferrer noopener">11tyTips/source/make/11ty/make.js</a></h5><h6><a href="https://prismjs.com" target="_blank" rel="noreferrer noopener" title="Highlighting provided by Prism.js">Prism</a></h6></hgroup><pre><code class="language-javascript">
const MAKE_o =
{
  markdownTemplateEngine: 'njk',
  htmlTemplateEngine:     'njk',
  dataTemplateEngine:     'njk',
  templateFormats:        [ 'njk', 'md' ],
  passthroughFileCopy:    true,
  pathPrefix:             '/',
  dir:
  {
    input:    '.',
    output:   '../site',
    data:     'matter/assets/scripts/js/lib',
    includes: 'matrix',
  },
<br/>
  tag_a:    //: to create collections
  [
    { tag_s: 'tip', sort_f: 'sortByRank__a' },
  ],
  static_o: { "matrix/assets/static": "assets" },    //: static files
  dirs_o:
  {
    makeDir_s:  './',
    pagesPartsDir_s: './matter/pages/parts',
  }
}
<br/>
module.exports = make_o =>
{
  make_o.tag_a = MAKE_o.tag_a
  make_o.matrixDir_s = MAKE_o.dir.includes
  make_o.pagesPartsDir_s = MAKE_o.dirs_o.pagesPartsDir_s
  make_o.addPassthroughCopy( MAKE_o.static_o )
; [ 'libraries',
    'shortcodes',
    'filters',
    'plugins',
    'collections'
  ].forEach( make_s => require( `${MAKE_o.dirs_o.makeDir_s}${make_s}.js` )( make_o ) )
  return MAKE_o    // : return the configuration object for further customization
}
<br/>
</code></pre></content></entry><entry><title>Global settings</title><link href="https://11tytips.netlify.com/tips/site_configure.html"/><updated>2019-12-12T01:00:00+01:00</updated><id>https://11tytips.netlify.com/tips/site_configure.html</id><content type="html"><h1>Configuring your new Eleventy site</h1><p data--="page_intro">Eleventy provides you with simple but efficient configuration options.</p><h2 id="data_everywhere">Data everywhere</h2><p>Eleventy provides a wide range of settings for <a href="https://www.11ty.io/docs/data/">data</a> used in building stage or inside content: <a href="https://www.11ty.io/docs/data-global/">global</a> data as well as <a href="https://www.11ty.io/docs/data-template-dir/">template and directory</a> data.</p><p>11tyTips uses only global data contained in JavaScript files located inside the data directory.</p><hgroup data--="code_ref"><h5><a href="https://github.com/octoxalis/11tyTips/blob/master/source/matter/assets/scripts/js/lib/U_o.js" target="_blank" rel="noreferrer noopener">11tyTips/source/matter/assets/scripts/js/lib/U_o.js</a></h5><h6><a href="https://prismjs.com" target="_blank" rel="noreferrer noopener" title="Highlighting provided by Prism.js">Prism</a></h6></hgroup><pre><code class="language-javascript">
const A_o = require( './A_o.js' )
<br/>
const U_o =
{
  dev_b: true,     //: development/production switch
  //dev_b: false,
  url_s: null,
<br/>
  DEV_s: A_o.LOCAL_s,
  PRO_s: A_o.URL_s,
<br/>
  GIT_s: `https://github.com/${A_o.AUTHOR_s}/${A_o.ID_s}/`,
  TWI_s: `https://twitter.com/${A_o.ID_s}/`,
  RSS_s: `${A_o.URL_s}feed.xml`,
  SERVICE_PATH_s: 'assets/scripts/js/service_worker.min.js',
<br/>
  HOME_s:    `[Home page]: ${A_o.URL_s}`,
  NODE_s :   `[Node.js]: https://nodejs.org`,
  COMMENT_s: `[utteranc.es]: https://github.com/utterance/utterances`,
<br/>
  FRAME_s:     '11ty Frame',
  FRAME_URL_s: `https://11tyframe.netlify.com/`,
<br/>
  ELEVENTY_s:     `[Eleventy]: https://11ty.io`,
  ELEVENTY_JFM_s: `/docs/data-frontmatter/#javascript-front-matter`,
  ELEVENTY_UDF_s: `/docs/data-frontmatter/#user-defined-front-matter-customizations`,
<br/>
  OUTLINK_s: '{target="_blank" rel="noreferrer noopener"}',
<br/>
}
void function () { U_o.url_s = U_o[U_o.dev_b === true ? 'DEV_s' : 'PRO_s'] } ()
console.log( `Site URL: ${U_o.url_s}` )
<br/>
module.exports = U_o
<br/>
</code></pre><p>The gobal data files can contain not only constants (as in the preceding listing of the <code>U_o.js</code> file )but also functions (as in the following <code>D_o.js</code> file )which means that all the power of Node.js is at hand.</p><hgroup data--="code_ref"><h5><a href="https://github.com/octoxalis/11tyTips/blob/master/source/make/lib/data.js" target="_blank" rel="noreferrer noopener">11tyTips/source/make/lib/data.js</a></h5><h6><a href="https://prismjs.com" target="_blank" rel="noreferrer noopener" title="Highlighting provided by Prism.js">Prism</a></h6></hgroup><pre><code class="language-javascript">
const EXPORT_a =    // default exported data
[
  'date',
  'layout',
  'permalink',
  'tags',
  'rank_n',
  'title_s',
  'subtitle_s',
  'abstract_s',
  'author_s',
  'A_o',
]
<br/>
module.exports =
{
  data__o: ( permalink_s, collection_a ) =>
  {
    //> console.log( permalink_s )
    let export_o = {}
    collection_a.forEach( collection_o =>
      {
        const data_o = collection_o.data
        if ( data_o.permalink === permalink_s )
        {
          if ( data_o.export_a === null ) export_o = data_o    //: get all data!
          else
          {
            const export_a = data_o.export_a || EXPORT_a    //: get declared or default data only
            export_a.forEach( prop_s => export_o[prop_s] = data_o[prop_s] )
          }
        }
      } )    
    return export_o
  },
}
<br/>
</code></pre></content></entry><entry><title>Styles guide</title><link href="https://11tytips.netlify.com/tips/styles_guide.html"/><updated>2019-12-12T01:00:00+01:00</updated><id>https://11tytips.netlify.com/tips/styles_guide.html</id><content type="html"><h1>Styles guide</h1><p>(h1 element)</p><p data--="page_intro">This is an introduction paragraph which should be limited in length.</p><p>(p element, styled with attribute “page_intro”)</p><h2 id="title">Title</h2>(h2 element)<h3 id="subtitle">Subtitle</h3>(h3 element<br/><b>Titles have a</b> <code>font-style: italic</code> )<p><strong>Paragraph</strong> content have a maximum line length fixed to 60ch, yielding to a number of of about 70 characters per line: this is considered the best line length for readibility. (p element)</p><p><code>for ( let at = 0; at &lt; keys_a.length; ++at )</code> (inline code)</p><p data--="example"><code>for ( let at = 0; at &lt; keys_a.length; ++at )</code> (example)</p><hgroup data--="code_ref"><h5><a href="https://github.com/octoxalis/11tyTips/blob/master/source/make/11ty/libraries.js" target="_blank" rel="noreferrer noopener">11tyTips/source/make/11ty/libraries.js</a></h5><h6><a href="https://prismjs.com" target="_blank" rel="noreferrer noopener" title="Highlighting provided by Prism.js">Prism</a></h6></hgroup><pre><code class="language-javascript">
module.exports = make_o =>
{
  let markdown_o =
  {
    html:        true,
    linkify:     true,
    typographer: true
  }
  make_o.setLibrary('md',
    require( 'markdown-it' )( markdown_o )
      .use( require( 'markdown-it-attrs' ) )
      .use( require( 'markdown-it-deflist' ) )
      .use( require( 'markdown-it-include' ), make_o.pagesPartsDir_s )
  )
  make_o.setLibrary('njk',
    require('nunjucks')
      .configure( make_o.matrixDir_s, { autoescape: false } ) )  //: autoescape for CSS rules
}
<br/>
</code></pre>(code block)<h3>Lists</h3><p>(Unordered list)</p><ul data--="ulist"><li>Primo</li><li>Secondo</li><li>Tertio</li></ul><p>(Nested unordered lists)</p><ul data--="ulist"><li>Primo<ul data--="ulist"><li>One</li><li>Two</li><li>Three</li></ul></li><li>Secondo<ul data--="ulist"><li>Un</li><li>Deux</li></ul></li><li>Tertio</li></ul><ul><li>Inside a short note, it works only preceded by a list item (<ul data--="ulist"><li>One</li><li>Two</li><li>Three )</li></ul></li></ul></content></entry><entry><title>Names guide</title><link href="https://11tytips.netlify.com/tips/names_guide.html"/><updated>2019-12-12T01:00:00+01:00</updated><id>https://11tytips.netlify.com/tips/names_guide.html</id><content type="html"><h1>Pseudo-typed JavaScript</h1><p data--="page_intro">How to identify variable types using a consistent naming scheme.</p><h2 id="no_static_typing?">No static typing?</h2><p>Every developer knows that JavaScript is not a static typed language, a useful feature eliminating lots of bugs. A language like Typescript has been created as a remedy to that important lack of safety. Even for code modules counting less than a few tens of lines, it’s easy to forget what kind of type is exactly a variable or constant declared at the begining of the file and then make a mistake when assining a wrong type to a variable.</p><p>11tyTips follows the <a href="https://typexjs.netlify.com" target="_blank" rel="noreferrer noopener">TypesJS</a> naming scheme for a cleaner and more meaningful code. Here is how it looks in action (the following listing is the service worker file integrated in 11tyTips which relies heavily on the excellent article by Thomas Hunter II: <a href="https://thomashunter.name/posts/2019-04-30-service-workers" target="_blank" rel="noreferrer noopener"><em>On using Service Workers with Static Content</em></a> ):</p><hgroup data--="code_ref"><h5><a href="https://github.com/octoxalis/11tyTips/blob/master/source/matrix/assets/scripts/js/parts/_service_worker_.js" target="_blank" rel="noreferrer noopener">11tyTips/source/matrix/assets/scripts/js/parts/_service_worker_.js</a></h5><h6><a href="https://prismjs.com" target="_blank" rel="noreferrer noopener" title="Highlighting provided by Prism.js">Prism</a></h6></hgroup><pre><code class="language-javascript">
/**
 * Unlike most Service Workers, this one always attempts to download assets from the network.
 * Only when network access fails do we fallback to using the cache. 
 * When a request succeeds we always update the cache with the new version.
 * If a request fails and the result isn't in the cache then we display an offline page.
 */
const ID_s      = '{{A_o.ID_s}}'
const KEY_n     = 1                             //: initial cache version
const CACHE_s   = `${ID_s}_${KEY_n}`            //: name of the current cache
<br/>
const URL_a = //: URLs of assets to immediately cache
[
  '{{U_o.url_s}}',
  '{{U_o.url_s}}index.html',
  '{{U_o.url_s}}menu.html',
  '{{U_o.url_s}}offline.html',
  '{{U_o.url_s}}assets/scripts/js/service_worker.min.js',
  '{{U_o.url_s}}assets/scripts/js/lib.min.js',
  '{{U_o.url_s}}assets/styles/css/lib.min.css',
  '{{U_o.url_s}}favicon.ico',
]
<br/>
/**
 * Iterate thru URL_a and add cache each entry
 */
const install__v = install_o =>
{
  install_o.waitUntil( caches.open( CACHE_s )
    .then( cache_o => cache_o.addAll( URL_a  ) )
    .then( self.skipWaiting() ) )
}
<br/>
/**
 * Remove inapplicable caches entries
 */
const activate__v = activate_o =>
{
  activate_o.waitUntil( caches.keys()
    .then( entry_a => entry_a.filter( entry_s => entry_s !== CACHE_s ) )
    .then( remove_a => Promise.all( remove_a.map( remove_s => caches.delete( remove_s ) ) ) )
    .then( () => self.clients.claim() ) )
}
<br/>
/**
 * Always try to download from server first
 */
const fetch__v = fetch_o =>
{
  fetch_o.respondWith( fetch( fetch_o.request )
      .then( response_o =>
      {
        cache__v( fetch_o.request, response_o )   //: download is successful: cache the result...
        return response_o.clone()                 //... and display it
      } )
      .catch( error_o => cache__o( error_o ) )    //: error_o means network fail (offline...)
  )
}
<br/>
/**
 * Try to fetch a cache version if network access issues
 */
const cache__o = fetch_o =>
{
  return caches.match( fetch_o.request )
    .then( response_o =>
    {
      return response_o ||        //: We have a cached version, display it
        caches.open( CACHE_s )    //: We don't have a cached version, display offline page
          .then( cache_o => cache_o.match( new Request( `{{U_o.url_s}}offline.html` ) ) )
    } )
}
<br/>
/**
 * Put successful fetch in cache
 */
const cache__v = ( request_o, response_o ) =>
{
  caches.open( CACHE_s )
    .then( cache_o => cache_o.put( request_o, response_o ) )
}
<br/>
self.addEventListener('install', install_o => install__v( install_o ) )
self.addEventListener('activate', activate_o => activate__v( activate_o ) )
self.addEventListener('fetch', fetch_o => fetch__v( fetch_o ) )
<br/>
</code></pre><p>As a side note, it’s worth noting that a declaration like</p><p data--="example">const ID_s = ‘{{A_o.ID_s}}’</p><p>is only made possible by the use of a minification filter during which Nunjucks variables are expanded before writing the JavaScript file! But it’s another story: <a href="https://11tytips.netlify.com/tips/minifying.html">minifying</a>…</p></content></entry><entry><title>Front matter</title><link href="https://11tytips.netlify.com/tips/frontmatter_data.html"/><updated>2019-12-12T01:00:00+01:00</updated><id>https://11tytips.netlify.com/tips/frontmatter_data.html</id><content type="html"><h1>Front matter data</h1><p data--="page_intro">Front matter, the initial section of each Markdown file, offers much more than you think.</p><h2 id="front_matter_is_all_you_need">Front matter is all you need</h2><p>Each Markdown file has its own data, declared at the begining of the file in the front matter part (11tyTips uses a JavaScript <code>Object</code> for the front matter. ), a few ones being mandatory (no so strickly speaking! For instance, you’re not requested to use a Date, but it’s more than useful if you want to sort your posts by date. ), others being used to supply some page specific content or variables (have a look at <a href="https://11ty.dev/docs/data-frontmatter/#user-defined-front-matter-customizations" target="_blank" rel="noreferrer noopener">Eleventy#user-defined-front-matter-customizations</a> for a list of Eleventy properties usable in front matter. ).</p><p><strong>Mandatory data</strong></p><ul data--="ulist"><li>Date (the Date property is mainly used to sort the posts but also to be shown it on the page. )</li><li>Layout (this is the template used to render the page. )</li><li>Permalink (this is the name of the output file: HTML, or any other format (e.g. minified JavaScript). )</li><li>Tags (the collection(s) including the output file. )</li></ul><p><strong>Specific data</strong></p><ul data--="ulist"><li>Menu index (Tip pages are sorted using this index, instead of the creation date. )</li><li>Title (used by 11tyTips to identify the page in the browser tab. )</li><li>Subtitle (Used by 11tyTips to describe the page content in the Tips list menu. )</li><li>Abstract (actually not used by 11tyTips, but could be… )</li><li>Author (useful if there are multiple authors for the posts of the site. )</li></ul><hgroup data--="code_ref"><h5><a href="https://github.com/octoxalis/11tyTips/blob/master/source/matter/pages/frontmatter_data.md" target="_blank" rel="noreferrer noopener">11tyTips/source/matter/pages/frontmatter_data.md</a></h5><h6><a href="https://prismjs.com" target="_blank" rel="noreferrer noopener" title="Highlighting provided by Prism.js">Prism</a></h6></hgroup><pre><code class="language-javascript">
---js
{
  date:      `2019-12-12`,
  layout:    `frame.njk`,
  permalink: `tips/frontmatter_data.html`,
  tags:      [ `tip` ],
  eleventyExcludeFromCollections: false,
<br/>
  rank_n:     8,
  title_s:    `Front matter`,
  subtitle_s: `Front matter data howto`,
  abstract_s: `Accessing front matter data in Markdown and templates`,
  author_s:   `Octoxalis`,
<br/>
  output__s: output_s => output_s.replace( /\[% raw %\]/g, '' ).replace( /\[% endraw %\]/g, '' ),
}
---
</code></pre><p>To access any property declared in the front matter it has to be enclosed in double parenthesis <code>{{ ... }}</code> (11tyTips uses Nunjucks. Using other templating systems, this is a bit different. ). For instance, the <code>abstract_s</code> property in the front matter is injected in this page with the following code: <code>{{ abstract_s }}</code> and renders as:<br/><q>Accessing front matter data in Markdown and templates</q>.</p><h2 id="function_properties">Function properties</h2><p>If you use JavaScript for the front matter (a very good idea because it gives you the full power of the language to process your content. )and Nunjucks as templating system, you can declare functions as properties (see <a href="https://11ty.dev/docs/data-frontmatter/#javascript-front-matter" target="_blank" rel="noreferrer noopener">Eleventy#javascript-front-matter</a> documentation page. ). Usually, apart very specific cases, it’s much more easy to declare content processing functions in a module located inside the data directory (because it will be accessible from any Markdown content or any template and with the possibility to require any Node package that could be useful. ).</p><p>However, this page front matter is such a case: the <code>output__s</code> front matter last property is a conventional way to execute a function after processing the entire page (see also <a href="https://11tytips.netlify.com/tips/frontmatter_function.html">frontmatter function</a> page. ).</p><h2 id="front_matter_properties_and_global_data_functions">Front matter properties and global data functions</h2><p>11tyTips is full of Eleventy documentation links: we need official references! Some of these references can appear in different pages and therefore they are potential global data. 11tyTips source has an <code>F_o.js</code> file inside its <code>matter/assets/scripts/js/lib</code> directory where a <code>eleventyUrl__s</code> function computes the link to any Eleventy docs page using an acronym of the page and anchor.</p><hgroup data--="code_ref"><h5><a href="https://github.com/octoxalis/11tyTips/blob/master/source/matter/assets/scripts/js/lib/F_o.js" target="_blank" rel="noreferrer noopener">11tyTips/source/matter/assets/scripts/js/lib/F_o.js</a></h5><h6><a href="https://prismjs.com" target="_blank" rel="noreferrer noopener" title="Highlighting provided by Prism.js">Prism</a></h6></hgroup><pre><code class="language-javascript">
eleventyUrl__s: key_s =>
{
  const path_s = U_o[ `ELEVENTY_${key_s}` ]
  const anchor_n = path_s.indexOf( '#')
  if ( anchor_n === -1 )    //: return a link to 11ty.io
  {
    console.log( `ALERT! no anchor found in path: ${path_s}` )
    const ref_n = U_o.ELEVENTY_s.indexOf( ':' )
    return { ref_s: U_o.ELEVENTY_s.substring( 0, ref_n ), link_s: U_o.ELEVENTY_s }
  }
  const anchor_s = path_s.substring( anchor_n )
  const anchorLink_s = U_o.ELEVENTY_s.replace( ']', `${anchor_s}]`) + path_s
  return { ref_s: anchorLink_s.substring( 0, anchorLink_s.indexOf( ':') ), link_s: anchorLink_s }
}
</code></pre><p>The acronyms (usually three characters are enough to get a unique identifier:<br/><code>JFM_s</code> for <code>#javascript-front-matter</code>,<br/><code>UDF_s</code> for <code>#user-defined-front-matter-customizations</code>. ), used as keys, could be set inside each page front matter and used as a key by the function to expand the actual link reference.</p><p>Hence to get the <em>reference</em> and the <em>link</em> of a <em>reference-style link</em> is just as easy as:</p><p data--="example"><code>{{ F_o.eleventyUrl__s( 'JFM_s' ).ref_s }}</code><br/><code>{{ F_o.eleventyUrl__s( 'JFM_s' ).link_s }}</code></p><p>Actually, most of Eleventy link keys are gathered in the <code>U_o.js</code> global data file and not in the front matter!</p><h3 id="even_shorter">Even shorter</h3><p>But we can do more, using Nunjucks <code>{% set %}</code> tag in each Markdown file referencing an Eleventy documentation page, then call the link function as in the following examples:</p><p data--="example"><code>{{ _11ty__s( 'JFM_s' ).link_s }}</code> (Reference-style link located in Links section, after the Aliases section. )</p><p data--="example"><code>{{ _11ty__s( 'JFM_s' ).ref_s }}</code> (reference inside content. )</p><hgroup data--="code_ref"><h5><a href="https://github.com/octoxalis/11tyTips/blob/master/source/matter/pages/frontmatter_data.md" target="_blank" rel="noreferrer noopener">11tyTips/source/matter/pages/frontmatter_data.md</a></h5><h6><a href="https://prismjs.com" target="_blank" rel="noreferrer noopener" title="Highlighting provided by Prism.js">Prism</a></h6></hgroup><pre><code class="language-javascript">
[comment]: # (======== Aliases ========)
{% set _11ty__s = F_o.eleventyUrl__s %}
<br/>
{{ _11ty__s( 'JFM_s' ).link_s }}
{{ _11ty__s( 'UDF_s' ).link_s }}
<br/>
[comment]: # (======== Post ========)
<br/>
</code></pre></content></entry><entry><title>Shortcodes</title><link href="https://11tytips.netlify.com/tips/shortcodes.html"/><updated>2019-12-12T01:00:00+01:00</updated><id>https://11tytips.netlify.com/tips/shortcodes.html</id><content type="html"><h1>Content processing with shortcodes</h1><p data--="page_intro">Shortcodes are probably the most powerful tool to process Markdown content inline.</p><h2 id="a_corner_stone">A corner stone</h2><p>They are simple to create and use, almost anything can be done with them, and they represent an important opportunity that should not be missed. Eleventy has two kinds of shortcode:</p><ul data--="ulist"><li>simple (the shortcode argument (i.e. content) is passed to a single tag (ex. #1). )</li><li>paired (the shortcode argument is passed enclosed between two tags (ex. #2). )</li></ul><p data--="example"><code>{% _shortcode_id &quot;argument&quot; %}</code></p><p data--="example"><code>{% _shortcode_id %}... Content to be processed ...{% end_shortcode_id %}</code></p><p>11tyTips doesn’t use a lot of shortcodes, but they are essential to its content. Let’s dissect the most omnipresent of it: the <code>_code_block</code> paired shortcode. It is passed to Eleventy configuration method <code>addPairedShortcode</code> this way:</p><p data--="example"><code>make_o.addPairedShortcode('_code_block', content_s =&gt; CODES_o.code_block__s( content_s ) )</code></p><p>Here, <code>_code_block</code> is the shortcode identifier (11tyTips uses a leading underscore character because the shortcode closing tag adds the word <code>end</code> before the shortcode identifier: <code>end_shortcode</code> is more readable than <code>endshortcode</code>, isn’t it? )</p><p data--="important">Shortcode anatomy <em>(to be continued...)</em></p></content></entry><entry><title>Minifying styles and script</title><link href="https://11tytips.netlify.com/tips/minifying.html"/><updated>2019-12-12T01:00:00+01:00</updated><id>https://11tytips.netlify.com/tips/minifying.html</id><content type="html"><h1>Minifying assets</h1><p data--="page_intro">Use the power of Node packages inside Eleventy.</p><h2 id="bypassing_build_tools">Bypassing build tools</h2><p>Build tools are tedious: that’s my opinion, when it comes to simple and static sites. And one of the strength of Eleventy is that you can bypass build tools to accomplish the necessary step of minifying some assets to speed up pages downloading. Of course, you need some processing to reduce all CSS or JavaScript files, but Node is full of packages to do that processing and compress those files and it would be a pity to ignore that power: simply call it up directly within your Eleventy build step.</p><p>One of the immediate benefices is that you can therefore split your assets in small chunks to manage them very easily during the development phase.</p><p data--="important">The realm of filters <em>(to be continued...)</em></p></content></entry><entry><title>Using shorthands</title><link href="https://11tytips.netlify.com/tips/shorthands.html"/><updated>2019-12-12T01:00:00+01:00</updated><id>https://11tytips.netlify.com/tips/shorthands.html</id><content type="html"><h1>Shorhand notation</h1><p data--="page_intro">For frequently used bits of content a shorthand notation is a useful practice.</p><h2 id="less_is_clean_and_meaningful">Less is clean and meaningful</h2><p data--="important">Using shorthand notation in markdown files is not only for lazy authors: it yields a more semantic code. <em>(to be continued...)</em></p></content></entry><entry><title>Front matter post processing function</title><link href="https://11tytips.netlify.com/tips/frontmatter_function.html"/><updated>2019-12-12T01:00:00+01:00</updated><id>https://11tytips.netlify.com/tips/frontmatter_function.html</id><content type="html"><h1>JavaScript front matter functions</h1><p data--="page_intro">For specific processing needs of a page, you can declare functions in the front matter section.</p><h2 id="post_processing_the_template_engine_output">Post processing the template engine output</h2><p>A singular use case of a front matter function (see <a href="https://11tytips.netlify.com/tips/frontmatter_data.html">frontmatter data</a> page for an introduction to front matter properties. )is when you want to process the output of the template engine. For instance, in Nunjucks, if you want to output something that would normaly be processed as a Nunjucks block (exactly what I’m doing writing this page! ), you have to enclose it in a <code>[% raw %][% endraw %]</code> tags pair. But it doesn’t work if you want to output only one tag of the pair either the <code>[% raw %]</code> or <code>[% endraw %]</code> tag. The shortcoming is simple: use a front matter function.</p><p>In the markdown file, the <code>raw</code> tags are writen by replacing the curly bracket characters (<code>{</code> and <code>}</code>) by the square bracket characters (<code>[</code> and <code>]</code>) and reverted to curly brackets after the template processing with the front matter function.</p><p>By convention, I call this front matter function <code>output__s</code> and it takes as argument the template engine output, to process it the way I want.</p><hgroup data--="code_ref"><h5><a href="https://github.com/octoxalis/11tyTips/blob/master/source/matter/pages/frontmatter_function.md" target="_blank" rel="noreferrer noopener">11tyTips/source/matter/pages/frontmatter_function.md</a></h5><h6><a href="https://prismjs.com" target="_blank" rel="noreferrer noopener" title="Highlighting provided by Prism.js">Prism</a></h6></hgroup><pre><code class="language-javascript">
---js
{
  //...
  output__s: output_s => output_s.replace( /\[% raw %\]/g, '{% raw %}' ).replace( /\[% endraw %\]/g, '{% endraw %}' )
}
---
<br/>
</code></pre><p>This <code>output__s</code> function is automaticaly invoqued (if it exists in the front matter part of any Markdown file) at the end of the global frame template passing the template engine result previously captured by a Nunkucks <code>{% set %} {% endset %}</code> block.</p><hgroup data--="code_ref"><h5><a href="https://github.com/octoxalis/11tyTips/blob/master/source/matrix/frame.njk" target="_blank" rel="noreferrer noopener">11tyTips/source/matrix/frame.njk</a></h5><h6><a href="https://prismjs.com" target="_blank" rel="noreferrer noopener" title="Highlighting provided by Prism.js">Prism</a></h6></hgroup><pre><code class="language-twig">
{%- set _template_s %}
<!doctype html><html lang="{{A_o.LANGUAGE_s}}">
{{- _head_block_s | safe | head_end( data_o ) -}}{# head process #}
{{- _body_block_s | safe | body_end( data_o ) -}}{# body process #}
</html>
{% endset -%}
<br/>
{%- if output__s %}{% set _template_s = output__s( _template_s ) %}{% endif -%}
<br/>
</code></pre><p>However, you are not at all constrained to process the output of the template engine globally: you can process only a part of it if you see fit as well as you can use multiple processing functions and multiple invocations. It’s just a question of enclosing the output to process in a <code>set</code> block.</p></content></entry><entry><title>Processing before and after the template engine</title><link href="https://11tytips.netlify.com/tips/pre_post_processing.html"/><updated>2019-12-12T01:00:00+01:00</updated><id>https://11tytips.netlify.com/tips/pre_post_processing.html</id><content type="html"><h1>Processing template output</h1><p data--="page_intro">It can be useful to process the final result of the templating work or prepare it by some pre processing.</p><h2 id="wrap_the_page_your_own_way">Wrap the page your own way</h2><p>All templating engines have limits and Nunjucks (which is used here by 11tyTips )has its own. But you can easily go your way beyond those limits to process the output of the templating engine just before everything is engraved as a static HTML page. For instance you may want to overcome the encoding output of the engine and make some modifications (see also the <a href="https://11tytips.netlify.com/tips/frontmatter_data.html">frontmatter data</a> tip for an example of post processing the template engine output without a global filter, but using a front matter specific callback function. ).</p><p>Once again this is acquired thru the use of a filter and an awesome help of the Nunjucks <code>{% set %}</code> block. Every global template (i.e. a template which produces a full <code>html</code> page. )has a <em>starting</em> block (in the following listing it’s the <em>ante</em> process comment line. )using a filter whose concern is to initialize some variables needed by the page which is about to be processed by the templating engine (it can be, for instance, a data base access (server-side), or some checking relative to the pages that have been previously processed, etc. ).</p><p>Similarly, there is an <em>ending</em> block whose filter processes the output of the template engine, once all the template work has been done, allowing you to further process the output. (in the following listing it’s the <em>post</em> process comment line. )</p><hgroup data--="code_ref"><h5><a href="https://github.com/octoxalis/11tyTips/blob/master/source/matrix/frame.njk" target="_blank" rel="noreferrer noopener">11tyTips/source/matrix/frame.njk</a></h5><h6><a href="https://prismjs.com" target="_blank" rel="noreferrer noopener" title="Highlighting provided by Prism.js">Prism</a></h6></hgroup><pre><code class="language-twig">
{% set data_o = D_o.data__o( permalink, collections.all ) %}
{{- '' | template_start( data_o ) -}}{# ante process #}
<br/>
{%- set _head_block_s %}
{% include "parts/blocks/_head_.njk" %}
{% endset -%}
<br/>
{%- set _body_block_s %}
{% include "parts/blocks/_body_.njk" %}
{% endset -%}
<br/>
{%- set _template_s %}
&lt;!doctype html&gt;&lt;html lang="{{A_o.LANGUAGE_s}}"&gt;
{{- _head_block_s | safe | head_end( data_o ) -}}{# head process #}
{{- _body_block_s | safe | body_end( data_o ) -}}{# body process #}
&lt;/html&gt;
{% endset -%}
<br/>
{%- if output__s %}{% set _template_s = output__s( _template_s ) %}{% endif -%}
{{- _template_s | safe | template_end( data_o ) | minify_html -}}{# post process #}
<br/>
</code></pre><h2 id="processing_at_build_start_or_end">Processing at build start or end</h2><p>The filters invoqued as previously described are also used to make any specific processing required just before the first template is to be processed by Eleventy and just after the last template has been processed. It’s kind of a hook, as can be seen is some frameworks, inside Eleventy. This <em>ante</em> or <em>post</em> processing uses only a directory listing to count the number of template files to be processed and invoque the starting function if no one has already been processed or the ending function if the number of files processed is equivalent to the listing count (this simple algorithm is based on the fact that all posts are in a single directory, without any subdirectories (otherwise the algorithm would have to walk thru all subdirectories), and that this <q>flat</q> directory contains only Markdown files. ).</p><hgroup data--="code_ref"><h5><a href="https://github.com/octoxalis/11tyTips/blob/master/source/make/lib/template_process.js" target="_blank" rel="noreferrer noopener">11tyTips/source/make/lib/template_process.js</a></h5><h6><a href="https://prismjs.com" target="_blank" rel="noreferrer noopener" title="Highlighting provided by Prism.js">Prism</a></h6></hgroup><pre><code class="language-javascript">
const STRING_o = require( './string.js' )
<br/>
let files_a       = null
let count_n       = 0
let current_n     = 0
<br/>
void function ()
{
  const MD_DIR_s = './matter/pages/'    //: all Mardown files
  const DEPTH_n  = 0                    //: ...are located at the root level of MD_DIR_s
  files_a = require( 'klaw-sync' )( MD_DIR_s, { nodir: true, depthLimit: DEPTH_n } )
  if ( files_a ) count_n = files_a.length
} ()
<br/>
const buildStart__v = data_o =>
{
  console.log( `${count_n} Markdown files to process` )
}
<br/>
const buildEnd__v = data_o =>
{
  //... what else?
}
<br/>
const templateStart__s = ( input_s, data_o ) =>
{
  let start_s = input_s
  //... what else?
  return start_s
}
<br/>
const templateEnd__s = ( input_s, data_o ) =>
{
  let end_s = input_s
  //... what else?
  return end_s
}
<br/>
const headEnd__s = ( input_s, data_o ) =>
{
  let head_s = input_s
  //... what else?
  return head_s
}
<br/>
const bodyEnd__s = ( input_s, data_o ) =>
{
  let body_s = input_s
  //... what else?
  return body_s
}
<br/>
module.exports =
{
  start__s: ( input_s, data_o ) =>
  {
    if ( !files_a ) return input_s
    if ( current_n === 0 ) buildStart__v( data_o )
    let start_s = templateStart__s( input_s, data_o )
    return start_s
  },
<br/>
  head__s: ( input_s, data_o ) => headEnd__s( input_s, data_o ),
<br/>
  body__s: ( input_s, data_o ) => bodyEnd__s( input_s, data_o ),
<br/>
  end__s: ( input_s, data_o ) =>
  {
    ++current_n
    let end_s = templateEnd__s( input_s, data_o )
    if ( current_n === count_n ) buildEnd__v( data_o )
    return end_s
  },
}
<br/>
</code></pre><p>Any kind of processing can be done inside the starting and ending functions: in 11tyTips, the starting function output the number of Markdown files to be processed and the ending function create the file (<code>menu.html</code>) listing the pages referenced as links in the menu of the site.</p><p>To have full control on the site data, these functions take as argument an <code>Object</code> gathering all or a selection of (made according to the <code>EXPORT_a</code> Array declared in the <code>F_o.js</code> global data file )all declared global data (including the <code>page</code> Object used for pagination, all the collection Objects and even global properties not usually accessible: <code>content</code> and <code>layoutContent</code>… ). These data are retrieve by a simple <code>set</code> tag at the begining of the base template:</p><hgroup data--="code_ref"><h5><a href="https://github.com/octoxalis/11tyTips/blob/master/source/matrix/frame.njk" target="_blank" rel="noreferrer noopener">11tyTips/source/matrix/frame.njk</a></h5><h6><a href="https://prismjs.com" target="_blank" rel="noreferrer noopener" title="Highlighting provided by Prism.js">Prism</a></h6></hgroup><pre><code class="language-twig">
{% set data_o = F_o.data__o( permalink, collections.all ) %}
<br/>
</code></pre><p>and are used by all the template processing functions (the <code>data_o</code> argument ).</p></content></entry><entry><title>Variables scope and templates inheritance</title><link href="https://11tytips.netlify.com/tips/variables_inheritance.html"/><updated>2019-12-12T01:00:00+01:00</updated><id>https://11tytips.netlify.com/tips/variables_inheritance.html</id><content type="html"><h1>Variables and templates inheritance</h1><p data--="page_intro">In Nunjucks, inheriting templates can have private variables.</p><h2 id="variables_and_blocks">Variables and blocks</h2><p>When you rely on template inheritance (using the <code>{% extends %}</code> declaration ), you cant’ have a <code>{% block %}{% endblock %}</code> inside a variable <code>set</code> block. The other way, a variable declared inside a <code>{% block %}{% endblock %}</code> will not be accessible outside. Therefore, you can’t gather all variables in a global variable passed as an argument to the processing filter. However, you still have the possibility to process each block individualy.</p><h3 id="variables_scope">Variables scope</h3><p>When using variables declared with the <code>set</code> block, never forget that any variable whose name begins with one or more underscore character is <strong>private</strong>. Therefore it can not be imported outside of its block scope (unfortunatly, the Nunjucks documentation doesn’t state it: I found this important note in the <a href="https://jinja.palletsprojects.com/en/2.10.x/templates/#import" target="_blank" rel="noreferrer noopener">Jinja2 documentation</a>. ).</p></content></entry><entry><title>Creating a menu</title><link href="https://11tytips.netlify.com/tips/creating_menu.html"/><updated>2019-12-12T01:00:00+01:00</updated><id>https://11tytips.netlify.com/tips/creating_menu.html</id><content type="html"><h1>Creating a menu</h1><p data--="page_intro">Creating a menu with previous and next links.</p><h2 id="sorting_a_collection">Sorting a collection</h2><p>There are many ways to sort a collection of posts, some of them provided out-of-the-box by Eleventy (see <a href="https://11ty.dev/docs/collections/#sorting" target="_blank" rel="noreferrer noopener">Eleventy#sorting</a> documentation page. ). However, 11ty Tips doesn’t use the formated date front matter property but a specific one, named <code>rank_n</code> (it’s an integer positive number ), allowing to sort a posts collection according a unique value regardless of the date (you could have multiple posts with the same date, unless you use a full date with hours, minutes and seconds… )This <code>rank_n</code> should therefore be a unique index (because it is used to retrieve the previous and next pages of any given post in the menu list; however, a duplicate <code>rank_n</code> index doesn’t cause any disturbance when retrieving those links (see infra). ).</p><hgroup data--="code_ref"><h5><a href="https://github.com/octoxalis/11tyTips/blob/master/source/make/11ty/collections.js" target="_blank" rel="noreferrer noopener">11tyTips/source/make/11ty/collections.js</a></h5><h6><a href="https://prismjs.com" target="_blank" rel="noreferrer noopener" title="Highlighting provided by Prism.js">Prism</a></h6></hgroup><pre><code class="language-javascript">
const sort_o =
{
//> Sort a tag collection
//> according to rank_n front matter property
  sortByRank__a: ( collection_a, tag_s ) =>
  {
    return collection_a
      .getFilteredByTag( tag_s )
      .sort( ( current_o, other_o ) => current_o.data.rank_n - other_o.data.rank_n )
  }
}
<br/>
module.exports = make_o =>
{
  make_o.tag_a.forEach( tag_o => make_o.addCollection( tag_o.tag_s,
    collection_a => sort_o[tag_o.sort_f]( collection_a, tag_o.tag_s ) ) )
}
<br/>
</code></pre><h2 id="listing_posts_as_an_html_fragment">Listing posts as an HTML fragment</h2><p>To display the global menu in every page of the site, an HTML fragment is built with a template listing all pages as links in an ordered list, each one having its page <code>rank_n</code> front matter property recorded as a <code>data-rank</code> attribute.</p><p>The main loop of the menu template iterates thru the posts collection previously sorted and add every useful data that we want to display in the menu itself or as a clue of the previous and next pages: <code>permalink</code>, <code>rank_n</code>, <code>title_s</code>, etc.</p><hgroup data--="code_ref"><h5><a href="https://github.com/octoxalis/11tyTips/blob/master/source/matrix/menu.njk" target="_blank" rel="noreferrer noopener">11tyTips/source/matrix/menu.njk</a></h5><h6><a href="https://prismjs.com" target="_blank" rel="noreferrer noopener" title="Highlighting provided by Prism.js">Prism</a></h6></hgroup><pre><code class="language-javascript">
{%- set _collection_s = A_o.COLLECTION_s %}
{# .... #}
{%- set _menu_list_s %}
  <ol data--="menu_list">
{% for _item_o in collections[_collection_s] %}
    {% if _item_o.data.tags == _collection_s %}
    {% set _link_s = _item_o.data.permalink.slice( 0, _html_n ) %}
    <li data--="menu_item" data-link="{{_link_s}}" data-rank="{{_item_o.data.rank_n}}">
      <span>{{pad__s( _item_o.data.rank_n )}}</span>
      <span><a href="{{U_o.url_s + _item_o.data.permalink}}">{{_item_o.data.title_s}}</a></span>
      ({{_item_o.data.abstract_s}})
      <span hidden>{{_item_o.data.subtitle_s}}</span>
    </li>
    {% endif %}
{% endfor %}
  </ol>
{% endset -%}
<br/>
</code></pre><h2 id="retrieving_posts_links_in_the_dom">Retrieving posts links in the DOM</h2><p>Previous and next posts links are much less difficult to retrieve on the client side than at build time. For that reason, the menu template doesn’t try to create a double linked list but instead delegates the work to a JavaScript function run in the browser. For any post page displayed by the browser, we have in the menu HTML fragment built by the template all necessary data about the preceding and following pages relative to the current one (when they exist: the first page in the menu list has no previous page and the last one no next page! ).</p><p>For that we have to search the DOM for the nodes having a <code>data-rank</code> attribute with values surrounding that one of the current page.</p><hgroup data--="code_ref"><h5><a href="https://github.com/octoxalis/11tyTips/blob/master/source/matrix/assets/scripts/js/parts/_link_page_.js" target="_blank" rel="noreferrer noopener">11tyTips/source/matrix/assets/scripts/js/parts/_link_page_.js</a></h5><h6><a href="https://prismjs.com" target="_blank" rel="noreferrer noopener" title="Highlighting provided by Prism.js">Prism</a></h6></hgroup><pre><code class="language-javascript">
//&gt; retrieve previous + next pages info
const linkNear__o = link_s =&gt;
{
  const list_e = document.querySelector( `[data--="menu_list"]` )
  const extension_n = '.html'.length
  const location_s = window.location.pathname.slice( 1, -extension_n )  //: trim '/' at start
  const list_a = document.querySelectorAll( `[data--="menu_list"] &gt; li` )
  if ( !list_a ) return     //: undefined
  const list_n = list_a.length
  const current_e = list_e.querySelector( `[data-link="${location_s}"]` )
  const rank_n = +current_e.getAttribute( 'data-rank' )
  const near_n = ( link_s === 'link_previous' ) ? rank_n - 1 : rank_n + 1
  if ( near_n &lt; 1 || near_n &gt; list_n ) return     //: undefined
  const near_e = list_e.querySelector( `[data-rank="${near_n}"]` )
  if ( !near_e ) return     //: undefined
  const a_e = near_e.querySelector( `span &gt; a` )
  if ( !a_e ) return     //: undefined
  const span_e = near_e.querySelector( `span[data--="note_content"]` )
  if ( !a_e ) return     //: undefined
  return {
    link_s:     near_e.getAttribute( 'data-link' ),
    title_s:    a_e.innerHTML,
    //?? subtitle_s: '',
    abstract_s: span_e.innerHTML,
  }
}
<br/>
</code></pre><h2 id="attaching_useful_data_to_links">Attaching useful data to links</h2><p>A link is only a link and doesn’t convey a lot of meaning by itself apart its URL (the <code>href</code> attribute ). Unveiling the title and some other pieces of data before fetching a previous or next post is a much more useful help. The data previously retrieved in the surrounding links of the current page are there to be used and we can display them as we like (bellow the navigation bar at the top of the page ).</p><hgroup data--="code_ref"><h5><a href="https://github.com/octoxalis/11tyTips/blob/master/source/matrix/assets/scripts/js/parts/_link_page_.js" target="_blank" rel="noreferrer noopener">11tyTips/source/matrix/assets/scripts/js/parts/_link_page_.js</a></h5><h6><a href="https://prismjs.com" target="_blank" rel="noreferrer noopener" title="Highlighting provided by Prism.js">Prism</a></h6></hgroup><pre><code class="language-javascript">
//> insert in DOM previous + next pages info
//> show/hide previous + next pages info block
const linkNear__v = ( event_s, link_e ) =>
{
  if ( link_e === null ) return
  if ( event_s === 'mouseenter' )
  {
    const link_s = link_e.getAttribute( 'data--' )
    let title_s
    let abstract_s
    const near_o = linkNear__o( link_s )
    if ( near_o !== undefined )
    {
      title_s = `<a href="https://11tytips.netlify.com/${near_o.link_s}.html">${near_o.title_s} ⤴</a>`
      abstract_s = `<i>${near_o.abstract_s}</i>`
    }
    else
    {
      title_s = 'No more tip'
      abstract_s = ''
    }
    document.querySelector( '[data--="link_title"]' ).innerHTML = title_s
    document.querySelector( '[data--="link_abstract"]' ).innerHTML = abstract_s
}
  document.querySelector( '[data--="link_info"]' )
    .classList.toggle( 'retract' )
}
</code></pre></content></entry><entry><title>CSS mixins</title><link href="https://11tytips.netlify.com/tips/css_mixins.html"/><updated>2020-01-02T01:00:00+01:00</updated><id>https://11tytips.netlify.com/tips/css_mixins.html</id><content type="html"><h1>CSS mixins</h1><p data--="page_intro">Do you really need SASS?</p><h2 id="mixins_without_preprocessor">Mixins without preprocessor</h2><p>CSS preprocessors as SASS have become an important step in the front-end landscape to simplify stylesheets creation and maintening. However they have lost a bit of prominance since the apparition of the new CSS rising star: <em>Custom properties</em> AKA <q>CSS variables</q>. And JAMstack static site generators as Eleventy could be another factor of preprocessors darkening because they give you all the bolts you need to create the elements you want to use and re-use with <strong>pure CSS and Vanilla JavaScript</strong>.</p><p>11tyTips contains an example of a pseudo-CSS file which, preprocessed by the Nunjucks template engine, produces a genuine CSS file with a few repeats of the same <code>@font_face</code> CSS rule pattern (only three repeats because 11tyTips is very thrifty regarding the number of fonts beeing used ).</p><hgroup data--="code_ref"><h5><a href="https://github.com/octoxalis/11tyTips/blob/master/source/matrix/assets/styles/css/parts/_font_face_mixin_.css" target="_blank" rel="noreferrer noopener">11tyTips/source/matrix/assets/styles/css/parts/_font_face_mixin_.css</a></h5><h6><a href="https://prismjs.com" target="_blank" rel="noreferrer noopener" title="Highlighting provided by Prism.js">Prism</a></h6></hgroup><pre><code class="language-twig">
/* defaults: styles: 'Regular', type_s: 'woff2' */
{{
  [
    { family_s:'Harmattan', file_s: 'harmattan-v5-latin-regular' },
    { family_s:'Athiti',    file_s: 'athiti-v3-latin-regular' },
    { family_s:'Fira Code', file_s: 'FiraCode-Regular' }
  ] | font_face( U_o.url_s )
}}
<br/>
</code></pre><p>But where is CSS in this <code>.css</code> file? Nowhere actually: the CSS fragment is created by the requested filter called <code>font_face</code>. And, apart the opening and closing double braces <code>{{ ... }}</code> (pointing out the declaration of a JavaScript variable ), everything is a JavaScript <code>Array</code> syntax declaration, an <code>Array</code> to be processed by that <code>font_face</code> filter.</p><p>Once again, the substitution is made by a <em>magical</em> Nunjucks filter registered at configuration step in the <code>11ty</code> directory <code>filters.js</code> file.</p><hgroup data--="code_ref"><h5><a href="https://github.com/octoxalis/11tyTips/blob/master/source/make/11ty/filters.js" target="_blank" rel="noreferrer noopener">11tyTips/source/make/11ty/filters.js</a></h5><h6><a href="https://prismjs.com" target="_blank" rel="noreferrer noopener" title="Highlighting provided by Prism.js">Prism</a></h6></hgroup><pre><code class="language-javascript">
//...
  const MIXIN_o = require('../lib/css_mixin.js')
  make_o.addFilter('font_face', ( face_a, ...args_ ) => MIXIN_o.font_face__s( face_a, ...args_ ) )
//...
<br/>
</code></pre><p>The <code>face_a</code> argument of this filter is the <code>Array</code> declared in the previous <code>_font_face_mixin_.css</code> file:</p><hgroup data--="code_ref"><h5><a href="https://github.com/octoxalis/11tyTips/blob/master/source/make/lib/css_mixin.js" target="_blank" rel="noreferrer noopener">11tyTips/source/make/lib/css_mixin.js</a></h5><h6><a href="https://prismjs.com" target="_blank" rel="noreferrer noopener" title="Highlighting provided by Prism.js">Prism</a></h6></hgroup><pre><code class="language-javascript">
module.exports =
{
  font_face__s: ( face_a, ...args_ ) =>
  {
    if ( !face_a || !args_ ) return ''
    let code_s = ''
    face_a.forEach( face_o =>
      {
        const family_s = face_o.family_s
        const file_s   = face_o.file_s
        const style_s  = face_o.style_s || 'Regular'
        const type_s   = face_o.type_s || 'woff2'
        code_s += `
@font-face
{
  font-display: swap;
  font-family: '${family_s}';
  font-style: normal;
  font-weight: 400;
  src:
    local('${family_s}'),
    local('${family_s}-${style_s}'),
    url('${args_[0]}assets/fonts/${file_s}.${type_s}')
    format('${type_s}');
}`
      }
    )
    return code_s
  },
<p>}
<br/>
</p></code></pre><p></p><p>The output of this CSS-like preprocessing is inlined (for performance concerns )in the page <code>head</code> section thru the <code>_font_note_.njk</code> template. Of course this is only available if you put a <code>&quot;dataTemplateEngine&quot;: &quot;njk&quot;</code> property inside your Eleventy configuration file (see <a href="https://11tytips.netlify.com/tips/eleventy_configure.html">eleventy configure</a> page ).</p><p>Data template engine processing, offered not only for Nunjucks but other templating systems, is a major strengh of Eleventy static site generator relevant not only for CSS preprocessing but also for JavaScript files preprocessing. Hence some 11tyTips JS files make use of global data variables or constants as (emphasized in the following examples ):</p><p data--="example">const idb_o = new KVIdb( ‘<strong>{{A_o.ID_s}}</strong>_idb’, ‘<strong>{{A_o.ID_s}}</strong>_store’ )</p><p data--="example">const key_s = location_s.slice( location_s.lastIndexOf( ‘<b>{{A_o.COLLECTION_s}}</b>s/’), -extension_n )</p><p>But there’s more to explore there…</p></content></entry><entry><title>Light(ning) images</title><link href="https://11tytips.netlify.com/tips/lightning_images.html"/><updated>2020-01-27T01:00:00+01:00</updated><id>https://11tytips.netlify.com/tips/lightning_images.html</id><content type="html"><h1>Intangible images</h1><p data--="page_intro">Where are my images?</p><h2 id="please,_no_delay">Please, no delay</h2><p>Web images are an endless challenge: we want them wide, beautiful, we want their colors, their evocation power, but in no case their slowness. Evidently images have to be optimised to be as light as possible. 11tyTips uses the outstanding <a href="https://compress-or-die.com/">Compress-Or-Die</a> site (Every front-end developer should visit this site not only for the impressive compression engine proposed by Christoph Erdmann but also for a thorough understanding of the JPEG format )to lighten and transform all images for a maximum speed gain. Nevertheless, 11tyTips goes further an enforces an <strong>on-demand image loading</strong> paradigm: any image is loaded only when the site visitor does want to open the Pandora box (this is my personal approach to the lazy loading pattern, both lighter and simpler to implement than the usual <em>Observer</em> pattern )!</p><p>To implement this pattern, the trick is to hide by default all images that do not need to be displayed inconditionnaly (therefore any image that is a substantial part of the site page (logo, hero, etc.) is not concerned by this on-demand pattern ), to unhide them, one by one, at a later time when a specific action is triggered by the visitor. That specific action is a simple opening of an inline note, tailored for the image case, as in the following <em>note</em> <ins data--="note_img"><sup></sup><span data--="note_content"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACwAAAAAAQABAAACAkQBADs=" alt="Adam de Coster" title="A young woman holding a distaff before a lit candle" data-src="https://11tytips.netlify.com/assets/media/Adam_de_Coster_wide.jpg" data-size="150"><br>)</span></ins></p><hgroup data--="code_ref"><h5><a href="https://github.com/octoxalis/11tyTips/blob/master/source/matter/pages/lightning_images.md" target="_blank" rel="noreferrer noopener">11tyTips/source/matter/pages/lightning_images.md</a></h5><h6><a href="https://prismjs.com" target="_blank" rel="noreferrer noopener" title="Highlighting provided by Prism.js">Prism</a></h6></hgroup><pre><code class="language-twig">
{% _note_img %}
![Adam de Coster][1PX]{data-src="{{U_o.url_s}}assets/media/Adam_de_Coster_Xwide.jpg" data-size="150"}
{% end_note_img %}
<br/>
[comment]: # (======== Links ========)
<br/>
[1PX]: {{U_o.url_s}}assets/media/1px.jpg "OnePixel"
<br/>
</code></pre><p>The <code>_note_img</code> shortcode has two parts:</p><ul data--="ulist"><li>a regular Markdown image declaration (the <code>![Adam de Coster][1PX]</code> part )</li><li>an associated Markdown attribute (the <code>{data-src=&quot;{{U_o.url_s}}assets/media/Adam_de_Coster_wide.jpg&quot;}</code> part )</li></ul><p>As soon as the site visitor clicks the note index for the first time, the image is loaded. This is not an automatic displaying but a manual one: <q>There is an image here, do you want to see it? If you do, here it is!</q> (Of course, if the image has a big size and the network flow is slow, the image will load slowly. Nevertheless, I think the user experience is much better having an overall very fast page loading and a potentially slow image loading, because this is a well known case, and, moreover, there is no need for any blurring or degraded image which only accentuate the waiting perception and finally slow down even more the genuine image display. )</p><h2 id="resize_à_la_carte">Resize à la carte</h2><p>For the sake of convinience, specific sizes can be specified for each image in the Markdown source: <ins data--="note_img"><sup></sup><span data--="note_content"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACwAAAAAAQABAAACAkQBADs=" alt="Adam de Coster" title="A young woman holding a distaff before a lit candle" data-src="https://11tytips.netlify.com/assets/media/Adam_de_Coster_wide.jpg" data-size="50%"><br>) The <code>data-size</code> attribute takes either a <strong>unique value</strong> (it will be applied to the width of the image, the height beeing supplied by the browser, keeping the image ratio ):</span></ins></p><p data--="example">data-size=“200”</p><p>or <strong>two values</strong> separated by a <code>space</code> character: (applied to the width then the height of the image ):</p><p data--="example">data-size=“200 200”</p><p>Since size values are converted in a style attribute added to the image HTML tag, any compliant CSS value can be used: <code>percentage</code>, <code>rem</code>, etc. <ins data--="note_img"><sup></sup><span data--="note_content"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACwAAAAAAQABAAACAkQBADs=" alt="Adam de Coster" title="A young woman holding a distaff before a lit candle" data-src="https://11tytips.netlify.com/assets/media/Adam_de_Coster_wide.jpg" data-size="25%"><br>):</span></ins></p><p data--="example">data-size=“25%”</p><p>When no size is added to the inline attribute, by default the image width is 100% of the page width. The <code>_note_img</code> shortcode also accept an <code>Array</code> argument to put a legend (each slot of this <code>Array</code> is a new line of the legend )under the image displayed <ins data--="note_img"><sup></sup><span data--="note_content"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACwAAAAAAQABAAACAkQBADs=" alt="Adam de Coster" title="A young woman holding a distaff before a lit candle" data-src="https://11tytips.netlify.com/assets/media/Adam_de_Coster_wide.jpg"><br><em class="note_img_title">Adam de Coster</em><br><b class="note_img_subtitle">Young women holding a distaff</b>).</span></ins></p><p data--="example"><code>{% _note_img [ 'Adam de Coster', 'Young women holding a distaff' ] %}</code></p><h2 id="a_1px_default">A 1px default</h2><p>Because a true image declaration is needed by the Markdown processor, a one pixel sized image data URI (see this base64 png pixel <a href="http://png-pixel.com/" target="_blank" rel="noreferrer noopener">generator</a> )is systematically used as a placeholder: it’s very light and 11tyTips has a CSS rule to prevent it to be displayed anyway. And it can be inserted at the end of the Markdown file like it is here, with the an helper function:</p><hgroup data--="code_ref"><h5><a href="https://github.com/octoxalis/11tyTips/blob/master/source/matter/pages/lightning_images.md" target="_blank" rel="noreferrer noopener">11tyTips/source/matter/pages/lightning_images.md</a></h5><h6><a href="https://prismjs.com" target="_blank" rel="noreferrer noopener" title="Highlighting provided by Prism.js">Prism</a></h6></hgroup><pre><code class="language-twig">
[comment]: # (======== Links ========)
[1PX]: {{ F_o.img1px__s() }} "A young woman holding a distaff before a lit candle"
<br/>
</code></pre><p>And here is the final code produced:</p><hgroup data--="code_ref"><h5>site/tips/lightning_images.html</h5><h6><a href="https://prismjs.com" target="_blank" rel="noreferrer noopener" title="Highlighting provided by Prism.js">Prism</a></h6></hgroup><pre><code class="language-html">
&lt;ins data--="note_img"&gt;
  &lt;sup&gt;&lt;/sup&gt;
  &lt;span data--="note_content"&gt;
    &lt;em class="note_link_a"&gt;
      &lt;a class="note_link" role="button" title="Load image in full color"
         onclick="loadColorImg__v( this, 'gray', 'color' )"&gt;C&lt;/a&gt;
    &lt;/em&gt;
    &lt;img src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACwAAAAAAQABAAACAkQBADs="
         alt="Adam de Coster" title="A young woman holding a distaff before a lit candle"
         data-src="http://127.0.0.1:5500/assets/media/Adam_de_Coster_gray.jpg"&gt;&lt;br&gt;
    &lt;em class="note_img_title"&gt;Adam de Coster&lt;/em&gt;&lt;br&gt;
    &lt;b class="note_img_subtitle"&gt;Young women holding a distaff&lt;/b&gt;
  &lt;/span&gt;
&lt;/ins&gt;
<br/>
</code></pre><h2 id="further_image_optimisation_and_control">Further image optimisation and control</h2><p>When images displayed using the on-demand loading mechanism described in this tip are an important matter for the site content (i.e. images are an substantial part of the content, not just an illustration to decorate the text content ), when image compression must preserve a high rendering quality, the image size can still be heavy, more than a few hundreds of kilobytes. A useful technique is to propose at first an meaningful presentation of the image in grayscale instead of full color! Actually, grayscale images, which eliminate the less meaningful part of the image data: color, and retain only the most one: luminosity, are so useful to the sensory perception that in some cases it’s an important step of the image content apprehension.</p><p>Hence, a double loading, first of a grayscale image then, <em>only if needed</em> (if the site visitor does want it: in the following example, by clicking the button above the image! ), the full size colored image, to replace the grayscale one <ins data--="note_img"><sup></sup><span data--="note_content"><em class="note_link_a"><a class="note_link" role="button" onclick="loadColorImg__v( this, 'gray', )"> ⤵</a></em><img src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACwAAAAAAQABAAACAkQBADs=" alt="Adam de Coster" title="A young woman holding a distaff before a lit candle" data-src="https://11tytips.netlify.com/assets/media/Adam_de_Coster_gray.jpg" data-size="100%"><br><em class="note_img_title">Adam de Coster [1586-1643]</em><br><b class="note_img_subtitle">Young women holding a distaff before a lit candle</b>).</span></ins></p><p>Most of the time the image tag <code>title</code> attribute (an its factotum the <code>alt</code> attribute )is enough, but sometimes it can be necessary to display more information, for instance a title, a place, a credit, etc. This is the purpose of the legend <code>Array</code> mentioned above. But some reactivity can be necessary too. This is the purpose of another shortcode, called <code>note_link</code>, an <code>Array</code> of strings, each one enclosing a function name with its symbol and arguments (if the function has arguments ):</p><p data--="example"><code>{% note_link [ 'loadColorImg__v, ⤵, gray, color' ] %}</code></p><p>Each slot of this <code>Array</code> yields a link with a <code>role=&quot;button&quot;</code> displaying the function symbol, a link triggering the function itself. In the previous image note, the function <code>loadColorImg__v</code> loads the full colored image replacing the much lighter gray one initialy loaded.</p></content></entry></feed>
