<!doctype html>
<html lang="en">
<head>
<script>
const _SITE_s='11tyTips';const _URL_s='https://11tytips.netlify.com/'
</script>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Processing before and after the template engine</title>
<meta name="description" content="Process templates your own way,A blog devoted to Eleventy static site generator users,Useful tips to use Eleventy static site generator: site structure, content processing, build processing, assets minifying">
<link rel="apple-touch-icon" sizes="180x180" href="https://11tytips.netlify.com/assets/media/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://11tytips.netlify.com/assets/media/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://11tytips.netlify.com/assets/media/favicon-16x16.png">
<link rel="manifest" href="https://11tytips.netlify.com/assets/site.webmanifest"><link rel="alternate" type="application/atom+xml" href="feed.xml" title="11tyTips"><style type="text/css">
@font-face{font-display:swap;font-family:Harmattan;font-style:normal;font-weight:400;src:local('Harmattan'),local('Harmattan-Regular'),url(https://11tytips.netlify.com//assets/fonts/harmattan-v5-latin-regular.woff2) format('woff2')}@font-face{font-family:Athiti;font-style:normal;font-weight:400;src:local('Athiti'),local('Athiti-Regular'),url(https://11tytips.netlify.com//assets/fonts/athiti-v3-latin-regular.woff2) format('woff2')}@font-face{font-display:swap;font-family:'Fira Code';src:local('Fira Code'),local('Fira Code-Regular'),url(https://11tytips.netlify.com//assets/fonts/FiraCode-Regular.woff2) format('woff2');font-weight:400;font-style:normal}:root{--font_title:'Athiti',sans-serif;--font_body:'Harmattan',sans-serif;--font_mono:'Fira Code',monospace;--font_code:90%}[data--=header_title],h1,h2,h3{font-family:var(--font_title)}.note_open,[data--=article],[data--=header_menu],[data--=tips_item],[data--=tips_menu]{font-family:var(--font_body)}.toolbar-item>button,[data--=code_ref],[data--=example],[data--=example]::before,[data--=header_menu]{font-size:var(--font_code)}[data--=example]::before,[data--=page_intro],h1,h2,h3{font-style:italic}[data--=header_title]{font-size:6rem}[data--=header_title]{font-weight:900}
</style>
<style type="text/css">
/*! destyle.css v1.0.7 | MIT License | https://github.com/nicolas-cusan/destyle.css */hr{box-sizing:content-box;height:0;overflow:visible;clear:both}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:bolder}sub,sup{line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}embed,iframe,object{vertical-align:bottom}button,input,select,textarea{-webkit-appearance:none;appearance:none;vertical-align:middle;color:inherit;font:inherit;outline:0;border-radius:0;text-align:inherit}[type=checkbox]{-webkit-appearance:checkbox;appearance:checkbox}[type=radio]{-webkit-appearance:radio;appearance:radio}[type=button],[type=reset],[type=submit],button{-webkit-appearance:none;appearance:none}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{min-width:0}legend{display:table;max-width:100%;white-space:normal}progress{vertical-align:baseline}textarea{overflow:auto}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button}label[for]{cursor:pointer}details{display:block}summary{display:list-item}table{border-collapse:collapse;border-spacing:0}td,th{vertical-align:top}th{font-weight:700}:root{--PAD_W:8;--PAD_1:calc( var(--PAD_W) * .5px );--PAD_2:calc( var(--PAD_1) * 2 );--PAD_4:calc( var(--PAD_1) * 4 );--PAD_8:calc( var(--PAD_1) * 8 );--BORDER_W:.25rem;--BORDER_1:calc( var(--BORDER_W) * 1 );--BORDER_2:calc( var(--BORDER_1) * 2 );--BORDER_3:calc( var(--BORDER_1) * 3 );--LINE_WIDTH:60ch;--MAX_WIDTH:calc( var(--LINE_WIDTH) * 2 )}:root{--c_hue_p:213;--c_hue_s:160;--c_hue_i:225;--c_hue_d:190;--c_hue_l:270;--c_sat:50%;--c_sat_hi:90%;--c_sat_lo:10%;--c_lum:50%;--c_lum_hi:90%;--c_lum_lo:10%;--c_opac:.5;--c_opac_hi:1;--c_opac_lo:.2;--c_prim_tr:hsla( var(--c_hue_p), var(--c_sat),    var(--c_lum), 0.6 );--c_prim_lo:hsla( var(--c_hue_p), var(--c_sat_hi), 16%, var(--c_opac_hi) );--c_secondary:hsla( var(--c_hue_s), var(--c_sat),    var(--c_lum), var(--c_opac_hi) );--c_sec_hi:hsla( var(--c_hue_s), var(--c_sat_hi), var(--c_lum_hi), var(--c_opac_hi) );--c_back:hsla( var(--c_hue_p), var(--c_sat_hi), var(--c_lum_hi), .4 );--c_back_hi:hsla( var(--c_hue_p), var(--c_sat_hi), var(--c_lum_hi), .2 );--c_back_lo:hsla( var(--c_hue_p), var(--c_sat_hi), var(--c_lum_hi), .6 );--c_back_op:hsla( var(--c_hue_p), var(--c_sat_hi), 93%, var(--c_opac_hi) );--c_decor:hsla( var(--c_hue_d), var(--c_sat_hi), var(--c_lum), var(--c_opac) );--c_decor_hi:hsla( var(--c_hue_d), var(--c_sat_hi), var(--c_lum_hi), var(--c_opac_hi) );--c_decor_lo:hsla( var(--c_hue_d), var(--c_sat_hi), var(--c_lum_lo), var(--c_opac_lo) );--c_advice:hsla( var(--c_hue_d), var(--c_sat), var(--c_lum), var(--c_opac_lo) );--c_extern:hsla( var(--c_hue_p), var(--c_sat), var(--c_lum_lo), var(--c_opac) );--c_link:hsla( var(--c_hue_l), var(--c_sat_hi), var(--c_lum), 1 )}*{box-sizing:border-box}::after,::before{box-sizing:inherit}address,blockquote,body,button,dl,fieldset,figure,form,h1,h2,h3,h4,h5,h6,hr,iframe,input,menu,ol,p,pre,select,table,textarea,ul{margin:0}[type=checkbox],[type=radio],button,fieldset,input,legend,menu,ol,select,textarea,ul{padding:0}ol,ul{list-style:none}dd{margin-left:0}[hidden],template{display:none}:-ms-input-placeholder,::-ms-input-placeholder,::-webkit-file-upload-button,::-webkit-input-placeholder,::placeholder{font:inherit}code,h1,h2,h3,h4,h5,h6,kbd,pre,samp{font-size:inherit}small{font-size:80%}sub,sup{font-size:75%}h1,h2,h3,h4,h5,h6{font-weight:inherit}address{font-style:inherit}h1,h2,h3,h4,h5,h6{line-height:inherit}dd{margin-left:0}code,kbd,pre,samp{font-family:monospace,monospace}a,button,input,select,textarea{background-color:transparent}a,legend{color:inherit}a{text-decoration:none}dl,ol,ul{list-style:none}button,select{text-transform:none}caption,th{text-align:left}button,embed,fieldset,hr,iframe,input,object,select,textarea{border:0}button,input{overflow:visible}[type=button],[type=reset],[type=submit],button{cursor:pointer}[type=button][disabled],[type=reset][disabled],[type=submit][disabled],button[disabled]{cursor:default}html{line-height:1.15;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent;--base_u:8;--font_min:calc( var(--base_u) * 2 );--font_max:calc( var(--base_u) * 3 );--screen_min:400;--screen_max:1600;font-size:calc((var(--font_min) * 1px) + (var(--font_max) - var(--font_min)) * (100vw - (var(--screen_min) * 1px))/ (var(--screen_max) - var(--screen_min)))}body{--font_u:1em;--font_r:1.1;--line_width:var(--LINE_WIDTH);--body_width:calc( ( var(--PAD_W) * 1vw ) + var(--MAX_WIDTH) + ( var(--PAD_W) * 1vw ) );max-width:var(--body_width);padding:0 calc(var(--PAD_W) * 1vw);background:var(--c_back_lo);font-size:var(--font_u);font-weight:400;letter-spacing:.01em;line-height:1.2}h1{margin-top:4rem;font-size:calc(var(--font_u) * var(--font_r) * 2.4);font-weight:800}h2,h3{margin-bottom:.5rem;font-weight:400;line-height:1}h2{margin-top:4rem;border-bottom:.1rem solid var(--c_decor);font-size:calc(var(--font_u) * var(--font_r) * 1.8);line-height:.7}h3{margin-top:2rem;font-size:calc(var(--font_u) * var(--font_r) * 1.5)}hr{border-top:var(--BORDER_1) solid var(--c_decor);margin:3rem 0 2rem 0}nav{background:var(--c_back)}section>footer,section>ol,section>p,section>table,section>ul{max-width:var(--line_width)}pre{background:0 0;border-left:var(--BORDER_2) solid var(--c_decor_hi);overflow-y:hidden}code{padding:.2rem .5rem;font-family:var(--font_mono)}pre>code{white-space:pre}p>code{font-size:inherit;white-space:pre}blockquote{padding:1rem 1.5rem;border-left:var(--BORDER_2) solid var(--c_sec_hi)}blockquote :last-child{margin-bottom:0}dl dl,dl ol,dl ul,ol dl,ol ol,ol ul,ul dl,ul ol,ul ul{font-size:var(--font_u);margin:.5rem 0 .5rem 1rem}dd,dt,li{margin-bottom:1rem}table{border-spacing:0;width:100%}td,th{border:.1rem solid var(--c_decor);padding:.4rem .8rem;text-align:left}td:first-child,th:first-child{padding-left:1rem}td:last-child,th:last-child{padding-right:0}b,strong{font-weight:700}a{color:var(--c_link);text-decoration-color:var(--c_link);text-decoration-thickness:.125em;text-underline-offset:1.5px}a:focus,a:hover{color:hsla(var(--c_hue_p),var(--c_sat_lo),var(--c_lum),1)}blockquote,dl,ol,p,table,ul{margin-top:1.5rem}pre{margin-bottom:1rem}.utterances{background:var(--c_extern)}[data--=header],[data--=tips_menu]{background:var(--c_back_op)}[data--=article],[data--=section],[data--=tips_item],[data--=tips_menu] h4{background:var(--c_back_hi)}.note_open{background:var(--c_back_lo)}.toolbar-item>button:hover,[data--=code_ref],[data--=example],[data--=header_menu]:hover,[data--=tips_item] span{background:var(--c_decor_hi)}[data--=important]::before{color:var(--c_decor)}.note_open,[data--=article],[data--=header],[data--=section],[data--=tips_item],[data--=tips_menu]{color:var(--c_prim_lo)}[data--=tips_menu]{position:absolute}[data--=header]{position:sticky}[data--=important]::before,[data--=inline_note],[data--=ulist]>li::before{position:relative}[data--=header]{z-index:2}[data--=menu_frame],[data--=tips_menu]{z-index:var(--MENU_SHOW)}[data--=menu_frame],[data--=tips_menu]{opacity:var(--MENU_SHOW)}.utterances,[data--=code_ref],[data--=example],[data--=note_content] code,[data--=page_intro],[data--=tips_menu],code[class*=language-],p>code,pre[class*=language-]{max-width:var(--MAX_WIDTH)}[data--=note_content],[data--=note_content] cite,[data--=note_content] code,[data--=note_content] strong,[data--=note_content] u,p>code{display:inline-block}.note_open,[data--=example]::before,pre>code{display:block}[data--=header_menu]:hover,[data--=inline_note],[data--=tips_order]{cursor:pointer}
</style><link rel="stylesheet" href="https://11tytips.netlify.com/assets/styles/css/lib.min.css" />
</head>

<body>
<label data--="header">
  <span data--="header_title">11ty Tips</span>
  <span data--="header_menu">All tips</span>
</label>
<iframe data--="menu_frame" src="https://11tytips.netlify.com/tips_list.html"></iframe>
<article data--="article">
  <section data--="section">
<h1>Processing template output</h1>
<p data--="page_intro">It can be useful to process the final result of the templating work or prepare it by some pre processing.</p>
<h2 id="wrap_the_page_your_own_way">Wrap the page your own way</h2>
<p>All templating engines have limits and Nunjucks
<ins data--="inline_note"><sup></sup><span data--="note_content">which is used here by 11tyTips
</span></ins>has its own. But you can easily go your way beyond those limits to process the output of the templating engine just before everything is engraved as a static HTML page.
For instance you may want to overcome the encoding output of the engine and make some modifications
<ins data--="inline_note"><sup></sup><span data--="note_content">see also the <a href="https://11tytips.netlify.com/tips/frontmatter_data.html">frontmatter data</a> tip for an example of post processing the template engine output without a global filter, but using a front matter specific callback function.
</span></ins>.</p>
<p>Once again this is acquired thru the use of a filter and an awesome help of the Nunjucks <code>{% set %}</code> block.
Every global template
<ins data--="inline_note"><sup></sup><span data--="note_content">i.e. a template which produces a full <code>html</code> page.
</span></ins>has a <em>starting</em> block
<ins data--="inline_note"><sup></sup><span data--="note_content">in the following listing it’s the first line <code>include</code> tag.
</span></ins>using a filter whose concern is to initialize some variables needed by the page which is about to be processed by the templating engine
<ins data--="inline_note"><sup></sup><span data--="note_content">it can be, for instance, a data base access (server-side), or some checking relative to the pages that have been previously processed, etc.
</span></ins>.</p>
<p>Similarly, there is an <em>ending</em> block whose filter processes the output of the template engine, once all the template work has been done, allowing you to further processed the output.
<ins data--="inline_note"><sup></sup><span data--="note_content">in the following listing it’s the last line <code>include</code> tag.
</span></ins></p>
<hgroup data--="code_ref">
<h5>source/matrix/frame.njk</h5>
<h6><a href="https://prismjs.com" target="_blank" rel="noreferrer noopener" title="Highlighting provided by Prism.js">Prism</a></h6>
</hgroup>
<pre><code class="language-twig">
{% include "parts/_template_start_.njk" %}{# ante process #}
<br>
{%- set _URL_s = _U_.url_s -%}
<br>
{%- set _head_block_s %}
&lt;head&gt;
{% include "parts/_site_url_.njk" %}
{% include "parts/_head_.njk" %}
{% include "parts/_seo_.njk" %}
{% include "parts/_description_.njk" %}
{% include "parts/_favicon_.njk" %}
{% include "parts/_feed_.njk" %}
{% include "parts/_font_inline_.njk" %}
{% include "parts/_style_inline_.njk" %}
{% include "parts/_style_.njk" %}
&lt;/head&gt;
{% endset -%}
<br>
{%- set _body_block_s %}
&lt;body&gt;
{% include "parts/_nav_.njk" %}
{% include "parts/_article_.njk" %}
{% if _U_.dev_b === false %}{% include "parts/_instant_page_.njk" %}{% endif %}
{% include "parts/_script_.njk" %}
{% if no_comments !== true %}
{#% include "parts/_colophon_.njk" %#}
{#% include "parts/_comment_.njk" %#}
{% endif %}
&lt;/body&gt;
{% endset -%}
<br>
{%- set _template_s %}
&lt;!doctype html&gt;
&lt;html lang="en"&gt;
{{ _head_block_s | safe }}
{{ _body_block_s | safe }}
&lt;/html&gt;
{% endset -%}
<br>
{% include "parts/_template_end_.njk" %}{# post process #}
<br>
</code></pre>
<hgroup data--="code_ref">
<h5>source/matrix/parts/_template_end_.njk</h5>
<h6><a href="https://prismjs.com" target="_blank" rel="noreferrer noopener" title="Highlighting provided by Prism.js">Prism</a></h6>
</hgroup>
<pre><code class="language-twig">
{%- if output__s %}{% set _template_s = output__s( _template_s ) %}{% endif -%}
{%- set _args_a = { date: date, permalink: permalink, tags: tags, title_s: title_s } -%}
{%- if _U_.dev_b === true %}
{{- _template_s | safe | template_end( _args_a ) -}}
{% else -%}
{{- _template_s | safe | template_end( _args_a ) | minify_html -}}
{% endif -%}
<br>
</code></pre>
<h2 id="processing_at_the_very_start_or_end">Processing at the very start or end</h2>
<p>The filters invoqued as previously described are also use to make any specific processing required just before the first template is to be processed by Eleventy and just after the last template has been processed. It’s kind of a hook, as can be seen is some frameworks, inside Eleventy. This <em>ante</em> or <em>post</em> processing uses only a directory listing to count the number of template files to be processed and invoque the starting function if no one has already been processed or the ending function if the number of files processed is equivalent to the listing count.</p>
<hgroup data--="code_ref">
<h5>source/make/11ty/template_process.js</h5>
<h6><a href="https://prismjs.com" target="_blank" rel="noreferrer noopener" title="Highlighting provided by Prism.js">Prism</a></h6>
</hgroup>
<pre><code class="language-javascript">
const MD_DIR_s = './matter/pages/'    //: all Mardown files
const DEPTH_n  = 0                    //: ...are located at the root level of MD_DIR_s
<br>
var files_a = require( 'klaw-sync' )( MD_DIR_s, { nodir: true, depthLimit: DEPTH_n } )
var count_n = files_a ? files_a.length : 0
var at_n    = 0
<br>
module.exports =
{
  start__s: ( input_s, args_a ) =>
  {
    let start_s = input_s
    if ( at_n === 0 && files_a ) require( './template_start' )( files_a )
    //...  process start_s
    return start_s
  },
<br>
  end__s: ( output_s, args_a ) =>
  {
    ++at_n
    let end_s = output_s
    //... process end_s
    if ( at_n === count_n && files_a ) require( './template_end' )( files_a )
    return end_s
  },
<br>
}
<br>
</code></pre>
<p>Any kind of processing can be done inside the starting and ending modules and the argument they receive can be anything else than the list of files to process. In 11tyTips, till now, these modules do not process anything.</p>
<hgroup data--="code_ref">
<h5>source/make/11ty/template_start.js</h5>
<h6><a href="https://prismjs.com" target="_blank" rel="noreferrer noopener" title="Highlighting provided by Prism.js">Prism</a></h6>
</hgroup>
<pre><code class="language-javascript">
module.exports = ( files_a, ...args_ ) =>
{
  console.log( `${files_a.length} Markdown files to be processed` )
}
<br>
</code></pre>
<hgroup data--="code_ref">
<h5>source/make/11ty/template_end.js</h5>
<h6><a href="https://prismjs.com" target="_blank" rel="noreferrer noopener" title="Highlighting provided by Prism.js">Prism</a></h6>
</hgroup>
<pre><code class="language-javascript">
module.exports = ( files_a, ...args_ ) =>
{
  console.log( `${files_a.length} Markdown files have been processed` )
}
<br>
</code></pre>
  </section>
</article>
<script src="//instant.page/2.0.0" type="module" integrity="sha384-D7B5eODAUd397+f4zNFAVlnDNDtO1ppV8rPnfygILQXhqu3cUndgHvlcJR2Bhig8"></script><script src="/assets/scripts/js/prism.min.js"></script>
<script src="/assets/scripts/js/lib.min.js"></script>
<hr><script
  data--="utterances_script"
  src="https://utteranc.es/client.js"
  repo="octoxalis/11tyTips"
  issue-term="title"
  theme="photon-dark"
  crossorigin="anonymous"
  async></script>
</body>

</html>

